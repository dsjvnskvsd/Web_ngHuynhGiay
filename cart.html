<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Gi·ªè h√†ng - Ho√†ng Huynh Shoes üëü</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: #f9f9f9;
      }
      .cart-container {
        width: 90%;
        max-width: 1000px;
        margin: 40px auto;
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
        color: #e63946;
        margin-bottom: 25px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px;
        text-align: center;
      }
      th {
        background: #e63946;
        color: white;
      }
      tr:nth-child(even) {
        background: #f6f6f6;
      }
      .product-img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
      }
      .remove-btn {
        background: #ff5555;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: 0.3s;
      }
      .remove-btn:hover {
        background: #d00000;
      }
      .checkout {
        margin-top: 20px;
        text-align: right;
      }
      .checkout button {
        background: #2a9d8f;
        color: #fff;
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.3s;
      }
      .checkout button:hover {
        background: #21867a;
      }
      .total {
        font-weight: 600;
        color: #e63946;
        font-size: 18px;
        margin-right: 20px;
      }
      .empty {
        text-align: center;
        font-size: 18px;
        color: #777;
        padding: 40px 0;
      }

      /* Popup ch·ªçn ng√¢n h√†ng */
      .bank-popup {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }
      .bank-popup.active {
        display: flex;
      }
      .bank-box {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        width: 400px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .bank-box select,
      .bank-box button {
        margin-top: 15px;
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 15px;
      }
      .bank-info {
        margin-top: 15px;
        background: #f7f7f7;
        padding: 15px;
        border-radius: 8px;
        text-align: left;
      }
      .bank-info p {
        margin: 6px 0;
        font-size: 15px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">
        <a href="index.html">Ho√†ng Huynh Shoes üëü</a>
      </div>
      <div id="userSection"></div>
    </div>

    <div class="cart-container">
      <h1>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h1>
      <div id="cartContent"></div>
    </div>

    <!-- Popup ch·ªçn ng√¢n h√†ng -->
    <div class="bank-popup" id="bankPopup">
      <div class="bank-box">
        <h3>Ch·ªçn ng√¢n h√†ng ƒë·ªÉ thanh to√°n</h3>
        <select id="bankSelect">
          <option value="">-- Ch·ªçn ng√¢n h√†ng --</option>
          <option value="VCB">Vietcombank</option>
          <option value="TPB">TPBank</option>
          <option value="MB">MB Bank</option>
          <option value="ACB">ACB</option>
          <option value="BIDV">BIDV</option>
        </select>
        <div class="bank-info" id="bankInfo"></div>
        <button onclick="closeBank()">ƒê√≥ng</button>
      </div>
    </div>

    <div class="footer">
      <p>Ho√†ng Huynh Shoes ¬© 2025 | Hotline: 0987 838 186</p>
    </div>

    <script src="main.js"></script>
    <script>
      const userData = JSON.parse(localStorage.getItem("currentUser") || "null");
      const cartContent = document.getElementById("cartContent");
      const bankPopup = document.getElementById("bankPopup");
      const bankSelect = document.getElementById("bankSelect");
      const bankInfo = document.getElementById("bankInfo");

      if (!userData) {
        cartContent.innerHTML = `<p class="empty">‚ö†Ô∏è B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p.<br>Vui l√≤ng <a href="login.html">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ xem gi·ªè h√†ng.</p>`;
      } else {
        const key = "cart_" + userData.username;
        const cart = JSON.parse(localStorage.getItem(key) || "[]");
        if (cart.length === 0) {
          cartContent.innerHTML = '<p class="empty">üõçÔ∏è Gi·ªè h√†ng tr·ªëng.</p>';
        } else {
          let total = 0;
          let html = `
            <table>
              <tr><th>·∫¢nh</th><th>T√™n s·∫£n ph·∫©m</th><th>Gi√°</th><th>X√≥a</th></tr>`;
          cart.forEach((p, i) => {
            total += p.price;
            html += `
              <tr>
                <td><img src="${p.image}" class="product-img"></td>
                <td>${p.name}</td>
                <td>${p.price.toLocaleString("vi-VN")}ƒë</td>
                <td><button class="remove-btn" onclick="removeItem(${i})">X√≥a</button></td>
              </tr>`;
          });
          html += `</table>
            <div class="checkout">
              <span class="total">T·ªïng: ${total.toLocaleString("vi-VN")}ƒë</span>
              <button onclick="openBank()">Thanh to√°n</button>
            </div>`;
          cartContent.innerHTML = html;
        }
      }

      function removeItem(index) {
        const key = "cart_" + userData.username;
        const cart = JSON.parse(localStorage.getItem(key) || "[]");
        cart.splice(index, 1);
        localStorage.setItem(key, JSON.stringify(cart));
        location.reload();
      }

      function openBank() {
        bankPopup.classList.add("active");
      }
      function closeBank() {
        bankPopup.classList.remove("active");
      }

      // Hi·ªÉn th·ªã th√¥ng tin ng√¢n h√†ng
      bankSelect.addEventListener("change", () => {
        const bank = bankSelect.value;
        if (!bank) {
          bankInfo.innerHTML = "";
          return;
        }

        const banks = {
          VCB: {
            name: "Vietcombank",
            stk: "0123456789",
            chuTK: "HOANG VIET ANH",
            code: "VCB-HHS-2025",
          },
          TPB: {
            name: "TPBank",
            stk: "0978881234",
            chuTK: "HOANG VIET ANH",
            code: "TPB-HHS-2025",
          },
          MB: {
            name: "MB Bank",
            stk: "999888777",
            chuTK: "HOANG VIET ANH",
            code: "MB-HHS-2025",
          },
          ACB: {
            name: "ACB",
            stk: "6655443322",
            chuTK: "HOANG VIET ANH",
            code: "ACB-HHS-2025",
          },
          BIDV: {
            name: "BIDV",
            stk: "1122334455",
            chuTK: "HOANG VIET ANH",
            code: "BIDV-HHS-2025",
          },
        };

        const info = banks[bank];
        bankInfo.innerHTML = `
          <p><b>üè¶ Ng√¢n h√†ng:</b> ${info.name}</p>
          <p><b>S·ªë t√†i kho·∫£n:</b> ${info.stk}</p>
          <p><b>Ch·ªß t√†i kho·∫£n:</b> ${info.chuTK}</p>
          <p><b>M√£ thanh to√°n:</b> ${info.code}</p>
          <button style="margin-top:10px;background:#2a9d8f;color:#fff;border:none;padding:10px 20px;border-radius:6px;"
            onclick="confirmPay('${info.name}')">X√°c nh·∫≠n thanh to√°n</button>
        `;
      });

      function confirmPay(bankName) {
        const cartKey = "cart_" + userData.username;
        const cart = JSON.parse(localStorage.getItem(cartKey) || "[]");
        const total = cart.reduce((s, p) => s + p.price, 0);
        const orderCode =
          "HHS" + new Date().getFullYear() + "-" + Math.floor(Math.random() * 900000 + 100000);

        // L∆∞u ƒë∆°n h√†ng cho admin
        const orderData = {
          code: orderCode,
          time: new Date().toLocaleString(),
          bank: bankName,
          total,
          items: cart,
        };
        const key = "orders_" + userData.username;
        const orders = JSON.parse(localStorage.getItem(key) || "[]");
        orders.push(orderData);
        localStorage.setItem(key, JSON.stringify(orders));

        // X√≥a gi·ªè h√†ng
        localStorage.removeItem(cartKey);

        alert(
          "‚úÖ Thanh to√°n th√†nh c√¥ng qua " +
            bankName +
            "!\nüßæ M√£ ƒë∆°n h√†ng c·ªßa b·∫°n: " +
            orderCode
        );
        closeBank();
        location.reload();
      }
    </script>
  </body>
</html>
